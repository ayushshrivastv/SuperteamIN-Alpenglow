\* TLC Model Configuration for Sampling Verification (Theorem 3)
\* This configuration specifically tests PS-P sampling resilience properties

SPECIFICATION Spec

\* Sampling-specific constants for Theorem 3 verification
CONSTANTS
    \* Core sampling parameters from whitepaper
    SlicesPerBlock = 64
    TotalShreds = 128
    ReconstructionThreshold = 32
    ResilienceParameter = 4
    SamplingMethod = "PS-P"
    
    \* Validator set configuration for testing various stake distributions
    Validators = {v1, v2, v3, v4, v5, v6, v7, v8, v9, v10, v11, v12, v13, v14, v15, v16, v17, v18, v19, v20}
    
    \* Stake distribution testing different scenarios
    \* Scenario 1: Uniform distribution (each validator has 50 stake units)
    Stake = [v1 |-> 50, v2 |-> 50, v3 |-> 50, v4 |-> 50, v5 |-> 50, 
             v6 |-> 50, v7 |-> 50, v8 |-> 50, v9 |-> 50, v10 |-> 50,
             v11 |-> 50, v12 |-> 50, v13 |-> 50, v14 |-> 50, v15 |-> 50,
             v16 |-> 50, v17 |-> 50, v18 |-> 50, v19 |-> 50, v20 |-> 50]
    
    \* Byzantine validators: 19% of total stake (190 out of 1000 total stake)
    \* This tests the boundary condition near the 20% threshold
    ByzantineValidators = {v1, v2, v3, v19}
    
    \* Erasure coding parameters (compatible with sampling parameters)
    K = 32
    N = 128
    
    \* Protocol parameters (reduced for sampling verification)
    MaxBlocks = 2
    BandwidthLimit = 1000
    RetryTimeout = 10
    MaxRetries = 3
    HighLatencyThreshold = 100
    LowLatencyThreshold = 50
    LoadBalanceTolerance = 10
    MaxBufferSize = 500
    
    \* Abstract sets for model checking
    Block = {b1, b2}
    ErasureCodedPiece = {p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, p12, p13, p14, p15, p16}

\* Safety invariants to verify sampling resilience
INVARIANT
    \* Core type safety
    TypeInvariant
    
    \* Sampling resilience properties
    SamplingResilienceInvariant
    PartitioningValidityInvariant
    SamplingNonEquivocationInvariant
    
    \* Bandwidth and safety constraints
    BandwidthSafety
    
    \* Erasure coding correctness
    DistinctIndices
    ValidErasureCode
    
    \* Non-equivocation guarantees
    RotorNonEquivocation

\* Temporal properties for liveness verification
PROPERTY
    \* Sampling method comparison - PS-P provides better resilience
    SamplingMethodComparison
    
    \* Progress with PS-P sampling
    ProgressWithPS_P
    
    \* Sampling resilience property
    SamplingResilienceProperty

\* State space bounds for efficient verification
CONSTRAINT
    \* Limit clock progression for bounded model checking
    clock <= 10
    
    \* Limit number of active blocks
    Cardinality(DOMAIN rotorBlocks) <= MaxBlocks
    
    \* Limit repair requests to prevent state explosion
    Cardinality(repairRequests) <= 5

\* Symmetry reduction for equivalent validators with same stake
SYMMETRY
    \* Validators with identical stake and Byzantine status are symmetric
    Permutations({v5, v6, v7, v8, v9, v10, v11, v12, v13, v14, v15, v16, v17, v18, v20})

\* View reduction to focus on sampling behavior
VIEW
    \* Focus on sampling-relevant state components
    <<SamplingMethod, BinAssignment, PartitionSampling, AdversarialSampleCount(PartitionSampling)>>

\* Performance and verification options
CHECK_DEADLOCK FALSE
ALIAS Alias

\* Action constraints to guide model checking toward sampling scenarios
ACTION_CONSTRAINT
    \* Prioritize sampling-related actions
    \/ \E leader \in Validators, blockId \in Nat : ShredAndDistribute(leader, blockId)
    \/ \E validator \in Validators, blockId \in Nat : RelayShreds(validator, blockId)
    \/ \E validator \in Validators, blockId \in Nat : AttemptReconstruction(validator, blockId)