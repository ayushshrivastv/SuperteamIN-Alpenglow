\* Author: Ayush Srivastava
SPECIFICATION Spec

CONSTANTS
    \* Medium validator set for "20+20" resilience testing
    Validators = {v1, v2, v3, v4, v5, v6, v7, v8, v9, v10}
    ByzantineValidators = {v9, v10}  \* Exactly 20% Byzantine stake
    OfflineValidators = {v7, v8}     \* Exactly 20% Offline stake
    
    \* Extended slot and view range
    MaxSlot = 5
    MaxView = 15
    MaxTime = 30
    
    \* Network parameters (partial synchrony model)
    GST = 5
    Delta = 2
    MaxMessageSize = 2048
    NetworkCapacity = 10000
    LeaderFunction(v, Vals) == CHOOSE x \in Vals : x = Vals[((v-1) % Cardinality(Vals)) + 1]  \* Round-robin
    MaxBufferSize = 100
    PartitionTimeout = 10
    
    \* Erasure coding parameters (Rotor)
    K = 4
    N = 6
    MaxBlocks = 10
    BandwidthLimit = 10000
    RetryTimeout = 3
    MaxRetries = 3
    
    \* Block and transaction limits
    MaxBlockSize = 500
    BandwidthPerValidator = 2000
    MaxTransactions = 50
    
    \* Protocol parameters (Votor)
    TimeoutDelta = 5
    InitialLeader = v1
    FastPathStake = 80  \* 80% required for fast path
    SlowPathStake = 60  \* 60% required for slow path (exactly available)
    SkipPathStake = 60  \* 60% required for skip path
    
    \* Cryptographic abstractions
    MaxSignatures = 50
    MaxCertificates = 20

\* State constraints for bounded exploration
CONSTRAINT StateConstraint
STATE_CONSTRAINT
    /\ currentSlot <= MaxSlot
    /\ clock <= MaxTime
    /\ \A v \in Validators : votorView[v] <= MaxView
    /\ Cardinality(networkMessages) <= 500
    /\ Cardinality(certificates) <= MaxCertificates
    /\ Cardinality(votorVotes) <= MaxSignatures
    /\ Cardinality(rotorShreds) <= N * MaxBlocks
    /\ Cardinality(networkPartitioned) <= 2

\* Properties to check
INVARIANT TypeOK
INVARIANT Safety
INVARIANT HonestVoteUniqueness
INVARIANT ChainConsistency
INVARIANT ResilienceBounds  \* Check 20+20 resilience

\* Progress properties
PROPERTY Liveness
PROPERTY EventualFinalization
PROPERTY PartitionRecovery

\* Resilience properties
PROPERTY Combined2020Resilience
PROPERTY ByzantineResilience
PROPERTY OfflineResilience

\* Symmetry reduction (exclude Byzantine and Offline validators)
\* v7 is Byzantine, v8 is Offline, so only include honest validators
SYMMETRY Permutations({v1, v2, v3, v4, v5, v6})

\* Action constraints
ACTION_CONSTRAINT ActionConstraint
ACTION_CONSTRAINT
    /\ Cardinality({msg \in networkMessages : msg.type = "block"}) <= MaxBlocks
    /\ Cardinality({msg \in networkMessages : msg.type = "vote"}) <= MaxSignatures
    /\ Cardinality({msg \in networkMessages : msg.type = "shred"}) <= N * MaxBlocks

\* Initial state predicates
INIT Init

\* Next-state relation
NEXT Next

\* View for incremental checking
\* Using key state components for differentiation
VIEW <<currentSlot, [v \in Validators |-> votorView[v]], Cardinality(finalizedBlocks[currentSlot])>>
